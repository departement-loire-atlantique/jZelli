env:
  global:
  - secure: I7hgdHJsjs8OAkiHOJOr7UqDgRDyrg47HDYcpkY9o8VPxspeOHXREukqjW+opjlw5DT8XlQIXXbGPjr+IL+1vTUlR4wcfFm9h8Du4rodvlTVolBHnjtHpV6eiPNVh3Zg51xtznqzcTJI7BiDFNUege1J2gtQy/+Bh1OpJ9JeFLJzJ3e0cPc+1Jk5IMJ2RIJ0g99Dn6H3yoBfrxRbpaWgeasuNX6oOgc7us35SkWJA9KpdtsOAq/Bf9vFmsLdUZV2Js6HwLZDo1ZVI1VRKikswuZ5XrojTRk34u+c1ABxizeeUxO8nGK8K6A8SEC/fwTmmqruhxJvdp/ZNZ5Nk/EDAKBPYNduisS+TqiyAaXk55T7ixcDC2SgxZYZX9zbvCy8i+Q3H5Eh/Qpwg+kUJhb2WWSVM8vlHmW6nmOfX7xORS17oHU1R+PucXVex1Sf5tGZIyTENeYm2ueQjfwH5yybaXbbBduYe1r9dfjHVgVuTmmdGSQMyIZZh5VRp2CqOgC16rr3AXuLhAHdpICZJa7c1FT7gygLNGGYJZt1MXo7WJ6OTiIZpE6GX0hjygKNXhDFwF0Vbq4z2T44J87Ya/fVzSCnoS8z2HiAluodDqz+5cmZj/6vXFnm0tThY/1l2RImnlZDAmIHWv7wck0SZwQ5n8GSPMLbqx0CuFYC5yGlMNw=
  - secure: oOZpzQSsMbV1psbldHoghRONOjIiJOE55bcShlXPuutTI22T6vNk4gV90htn7AX7kIskQ3W2BARpqWG767Q8p+QMhHWDtzBysZPPlbyucQCuIjMUCBvowpoT/hYOb5nXHcSMSSME4IIz958bNIEIRy9MMmc6rdfCmWjgPOmznh9D6aQHIJCqR6V2Rdz8eWAg7ByTBQ/Xt61fDHGrJQDF6nN+ph0Z4s6tuKwBYGOEYVBQkkDlUgRLPX+mS/DEcYvYhr3K0dED8XrTkT6Kvk1WCgwPPxpn4AFd6B8ee6VvDf362KV4b2t9rUTpVR0n4RuTkJkHh/WSrIjSNDyf/VlJPnKDpwldmWIgacXHiSmmdQQaNOXuFffDuWW9tGlBjhA4zGQAkNPTbHrQSOl6SC2nB5e4y4GV224iqbtctxQY64ZT0F5WUFtExp2gkooGAD00cb4Qd6MRNeGo43aMZXyQwm4Dl8M1MXF3Wms3aCJUTiO6tglbfsovHAUGrnEE4L0Xo4Q7npFc6efZpE6L8zYI9baAEwMAPx/cywoR0g3C0golESzShxjAv6aet5foWS91yfotYWey3Fn8YxKvIY0nSvS1afah/l3xWW0jxVcyLCA0d6KoPKuw1odQlIuYUgDgW2ysYom3znNfCD2d0pBGxnVUoe/lioBwLrjnRyL2Amg=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: lPKLso96q50nFhLtqUxIjmdsG678oEfOGLBDe36h7GA+sZFO8y1GLJlNFSMMsjAtSWBz0YOfruo1tXKqDMO31KOgn2DfEA2b8rQgybo98VqHS+SP8cS43QHvpDaMkWH7wKw13ocWJBkBBio4gUmH7O2bFYH2puSMeDKnf6pbds3tKhno+/pe7YF3RfESjIuYQwk9FOe4yxNq5c04/Bt+uv6R9oP39ixx2sWH7ddYWka/5epCDgBlTUEeGxpmBfj6O21TgwNEl5BaU+CFZp4kXm4fYeFYtGBuPopLpcWq813LLAU0BLt5UAN9X9NqIYi8hRfbcng0KFepS/k/4Ia6D7WcGcTFyM9y/IDczdZE99ys/tOPTDVanMRDmqq2HnWJo2Ify11SJ2UFXNKgUUc72xb0b9bsYlR+NOFTyR+5UCPW3teIuB0GDN2eXY0UfBVOhex6s5mbm2kBDWvmW9iNgXEzFlk0L/I6+y1OAvaaYRRHZ8acyidap5i3EoeA1zVS7ydXe0QZ4Ckd8Wk5DKuiK2JuU4AvEIOo9VqLE74kbWsESfjeosx+Rhczc06WXKOzVSB2/jmljmLNaQ1fcDf1zuCnseUCcUCmRKTmTE/pEDOLbphU3qw4GviJ5NKicLKNk90xEk2lNL46XpivE5+a0BTDOr80WGjww+9CuUpMqjc=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild:1.1

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild:1.1
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: uEZa0sJlfXonUuTS+zl3a7msgGLgvemLAsetS1R7ULsq9p6fSg134HTc/u0gKyLSArlwJybleoLEX2JgpEUQNILXmFpwSVOVTxDi3s+HR9W0zihXdYKIPf4Hw8b3yO9shQ9OUPgfpDDxlbZx0cj4nE+AnGLbxYk5M0sRReGBdAjMEJavT31C0UZxmVQtMrERhUuCo6Dz78hQrkHrQAlaMI9ML6YVML0dlZSK7nOrQEtk3WUYkAkFjSNFQs5nAOD5zZLhuvbpYwJQ7t3E9JwqkFagJvbcRv3Z1ORMOSPQa9oLqiv5lXmwszc3jb1+GC/M8u17ruplDNHnu8ajQrhQaj2xN+b5ATH7jeBn/EJgS53HOzu7OuW5ts9p588667Xg1x1P6W2pHRK4oiTPq8iyxPsCFLNv/R9GiZJWgH8ldEqKncUBJ7mykYa4x8LPDIyqr+9GKDDzbdN9FgdXCJTw8jroY0DlkqouAzdgxYa3tBNeJsBwNcAvXnLci0ICUfJBFr7HBCZDkQlqoBhbPrMdMMCU0TWwNUDY+k4dbE0UvY5WSo/dVXHpc58+ouYFa0mHIkmqIbohJNsiZaaxvq9hbCbtjzG6v4LATyrmKxS6ER16BRSXGvhuJzxKNxASCNQejoOj1DwjcxzC9VgLLdL0ynTztxPDQs1nGDy/IA1VRcw=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
