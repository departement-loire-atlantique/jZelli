env:
  global:
  - secure: I7hgdHJsjs8OAkiHOJOr7UqDgRDyrg47HDYcpkY9o8VPxspeOHXREukqjW+opjlw5DT8XlQIXXbGPjr+IL+1vTUlR4wcfFm9h8Du4rodvlTVolBHnjtHpV6eiPNVh3Zg51xtznqzcTJI7BiDFNUege1J2gtQy/+Bh1OpJ9JeFLJzJ3e0cPc+1Jk5IMJ2RIJ0g99Dn6H3yoBfrxRbpaWgeasuNX6oOgc7us35SkWJA9KpdtsOAq/Bf9vFmsLdUZV2Js6HwLZDo1ZVI1VRKikswuZ5XrojTRk34u+c1ABxizeeUxO8nGK8K6A8SEC/fwTmmqruhxJvdp/ZNZ5Nk/EDAKBPYNduisS+TqiyAaXk55T7ixcDC2SgxZYZX9zbvCy8i+Q3H5Eh/Qpwg+kUJhb2WWSVM8vlHmW6nmOfX7xORS17oHU1R+PucXVex1Sf5tGZIyTENeYm2ueQjfwH5yybaXbbBduYe1r9dfjHVgVuTmmdGSQMyIZZh5VRp2CqOgC16rr3AXuLhAHdpICZJa7c1FT7gygLNGGYJZt1MXo7WJ6OTiIZpE6GX0hjygKNXhDFwF0Vbq4z2T44J87Ya/fVzSCnoS8z2HiAluodDqz+5cmZj/6vXFnm0tThY/1l2RImnlZDAmIHWv7wck0SZwQ5n8GSPMLbqx0CuFYC5yGlMNw=
  - secure: oOZpzQSsMbV1psbldHoghRONOjIiJOE55bcShlXPuutTI22T6vNk4gV90htn7AX7kIskQ3W2BARpqWG767Q8p+QMhHWDtzBysZPPlbyucQCuIjMUCBvowpoT/hYOb5nXHcSMSSME4IIz958bNIEIRy9MMmc6rdfCmWjgPOmznh9D6aQHIJCqR6V2Rdz8eWAg7ByTBQ/Xt61fDHGrJQDF6nN+ph0Z4s6tuKwBYGOEYVBQkkDlUgRLPX+mS/DEcYvYhr3K0dED8XrTkT6Kvk1WCgwPPxpn4AFd6B8ee6VvDf362KV4b2t9rUTpVR0n4RuTkJkHh/WSrIjSNDyf/VlJPnKDpwldmWIgacXHiSmmdQQaNOXuFffDuWW9tGlBjhA4zGQAkNPTbHrQSOl6SC2nB5e4y4GV224iqbtctxQY64ZT0F5WUFtExp2gkooGAD00cb4Qd6MRNeGo43aMZXyQwm4Dl8M1MXF3Wms3aCJUTiO6tglbfsovHAUGrnEE4L0Xo4Q7npFc6efZpE6L8zYI9baAEwMAPx/cywoR0g3C0golESzShxjAv6aet5foWS91yfotYWey3Fn8YxKvIY0nSvS1afah/l3xWW0jxVcyLCA0d6KoPKuw1odQlIuYUgDgW2ysYom3znNfCD2d0pBGxnVUoe/lioBwLrjnRyL2Amg=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantiqu-1
    token:
      secure: lPKLso96q50nFhLtqUxIjmdsG678oEfOGLBDe36h7GA+sZFO8y1GLJlNFSMMsjAtSWBz0YOfruo1tXKqDMO31KOgn2DfEA2b8rQgybo98VqHS+SP8cS43QHvpDaMkWH7wKw13ocWJBkBBio4gUmH7O2bFYH2puSMeDKnf6pbds3tKhno+/pe7YF3RfESjIuYQwk9FOe4yxNq5c04/Bt+uv6R9oP39ixx2sWH7ddYWka/5epCDgBlTUEeGxpmBfj6O21TgwNEl5BaU+CFZp4kXm4fYeFYtGBuPopLpcWq813LLAU0BLt5UAN9X9NqIYi8hRfbcng0KFepS/k/4Ia6D7WcGcTFyM9y/IDczdZE99ys/tOPTDVanMRDmqq2HnWJo2Ify11SJ2UFXNKgUUc72xb0b9bsYlR+NOFTyR+5UCPW3teIuB0GDN2eXY0UfBVOhex6s5mbm2kBDWvmW9iNgXEzFlk0L/I6+y1OAvaaYRRHZ8acyidap5i3EoeA1zVS7ydXe0QZ4Ckd8Wk5DKuiK2JuU4AvEIOo9VqLE74kbWsESfjeosx+Rhczc06WXKOzVSB2/jmljmLNaQ1fcDf1zuCnseUCcUCmRKTmTE/pEDOLbphU3qw4GviJ5NKicLKNk90xEk2lNL46XpivE5+a0BTDOr80WGjww+9CuUpMqjc=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull asfram/jplatformbuild:1.1

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t asfram/jplatformbuild:1.1
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: W/05W5ss2h6EtSSKuwvUKiXi08WJTCM1vVVlP9Mh6EAguyGZ4H6JklgCoRrQuNE+SQfa8/QXMiK5YEhO6NWhpHw3jm5VO+sWghDaxCzjo0nd4z5k04wLxfjNU1PPJdfXy6cAY0PoRbVC2Y3g9faZIEzhZrYfPaHOSIfhaUPUQYfslCQwm7do1+w4yuL7xkx+bAWKKhnxrFNhnPfa0vTJsu6qiMDfpZL1BI8rcTkcJVUDZIegq2YakVxflqL/iQ7Adg4Yg8zVBBuM/W/FpQFyPLIFNbl73CX1rwJUtAqrDBnPd8JMV7LlSnbPwjhK3c2n7KJ/U7HRqcOBEnYK2tiBmRMTUZ72khbhfT5qBT14xUIpzrxRanY8G1duszYl5Kc5I9KM19lM800PN7nW48G/EFvXqoFqTkY/u1Dhjov95sNAoon6UQuoLQguRo6MOkXejqCmdcwngBd3/92XKIO7B3foNDgz7BR5T0q+weCVcguyfdWeikDXFpHXc+15Pte3ABRVMRUcpvyHbG/JuQWUxqmYCmARyzxmA+qS9TG2V79l7jM0Xhy+RZQONwHSyALTAfa+E0Ow5M7gf6/HCOhZFvxdKPFwClCWUMjHbaBjCLEx7Q/9/80RZ+DBHZ7FDm95Koumie4IJ7LEyieSg6vsxYuNSUxg32bCVLC1xEsME+w=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
